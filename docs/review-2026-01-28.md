# Revisao tecnica (2026-01-28)

Contexto: API em producao com ~20 clientes simultaneos. Foco em riscos imediatos, estabilidade e seguranca.

## Itens criticos (corrigir primeiro)

1) Execucao com workers no Windows nao sobe corretamente
   - Onde: `main.py` (chamada `hypercorn.asyncio.serve` sem await)
   - Impacto: modo com `--workers > 0` pode nao iniciar/servir requisicoes.
   - Estimativa: 1-2h (ajustar execucao + teste de startup).

2) SECRET_KEY padrao pode ir para producao
   - Onde: `config.py` (default "change-me")
   - Impacto: tokens JWT podem ser falsificados se o segredo nao for trocado.
   - Estimativa: 1h (definir segredo em ambiente e validar boot).

## Itens de alto valor (seguranca/estabilidade)

3) CORS amplo para rede local + allow_credentials
   - Onde: `config.py`
   - Impacto: qualquer host na LAN pode fazer chamadas autenticadas se o cliente compartilhar o mesmo navegador/armazenamento.
   - Estimativa: 2-4h (migrar para lista de origens permitidas via `.env` e documentar).

4) Fallback para senha em texto plano
   - Onde: `auth/router.py` (`verify_password`)
   - Impacto: se houver hashes invalidos/legados, pode permitir login inseguro.
   - Estimativa: 4-8h (migrar hashes legados, remover fallback, validar usuarios existentes).

5) Ausencia de rate limit no login
   - Onde: `auth/router.py` (endpoint `/auth/login`)
   - Impacto: risco de brute force e abuso.
   - Estimativa: 4-8h (implementar rate limit por IP/usuario e monitorar).

## Melhorias recomendadas (nao criticas)

6) TLS/HTTPS obrigatorio no deploy
   - Onde: infraestrutura/reverse proxy
   - Impacto: protege credenciais/token em trafego local e externo.
   - Estimativa: 2-4h (configurar proxy TLS e headers).

7) Observabilidade basica
   - Onde: `logging_config.py`, `middleware/metrics.py`
   - Impacto: melhora diagnostico de falhas e latencia.
   - Estimativa: 4-6h (padronizar logs + correlacao de request).
