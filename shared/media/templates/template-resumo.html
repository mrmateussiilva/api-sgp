<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <style>
    @page { size: A4 portrait; margin: 0; }

    * { box-sizing: border-box; -webkit-print-color-adjust: exact; print-color-adjust: exact; }

    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: #fff;
      color: #111;
    }

    .item {
      width: 210mm;
      min-height: 140mm;
      padding: 6mm 10mm;
      border-bottom: 1px dashed #e5e5e5;
      break-inside: avoid;
      page-break-inside: avoid;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 4mm;
    }

    .item:last-child { border-bottom: none; }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6mm;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.2px;
      color: #777;
    }

    .topbar .left { display: flex; gap: 6mm; align-items: center; min-width: 0; }
    .topbar .right { white-space: nowrap; }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 1.2mm 2.8mm;
      border-radius: 10mm;
      font-weight: 900;
      font-size: 9px;
      border: 1px solid #eaeaea;
      background: #fafafa;
      color: #666;
      white-space: nowrap;
    }
    .badge-high { border-color: #fecaca; background: #fff1f2; color: #be123c; }
    .badge-normal { border-color: #e5e7eb; background: #f9fafb; color: #6b7280; }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }

    .ident {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8mm;
      align-items: center;
      border-top: 1px solid #f2f2f2;
      border-bottom: 1px solid #111;
      padding: 3mm 0;
    }

    .orderid {
      font-size: 30px;
      font-weight: 200;
      line-height: 1;
      white-space: nowrap;
    }

    .client { min-width: 0; }
    .client .name {
      font-size: 16px;
      font-weight: 900;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .client .contact {
      font-size: 11px;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .products {
      display: flex;
      flex-direction: column;
      gap: 4mm;
    }

    .produto {
      border: 1px solid #f0f0f0;
      border-radius: 4mm;
      padding: 3mm;
      display: flex;
      flex-direction: column;
      gap: 2mm;
      break-inside: avoid;
      page-break-inside: avoid;
    }

    .produto-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4mm;
    }

    .produto-title {
      font-size: 12px;
      font-weight: 900;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .produto-meta {
      display: flex;
      align-items: center;
      gap: 4mm;
      font-size: 10px;
      color: #666;
    }

    .chip {
      padding: 1.2mm 2.4mm;
      border: 1px solid #eee;
      border-radius: 3mm;
      font-size: 9px;
      font-weight: 900;
      color: #6b7280;
      background: #fafafa;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .qtd {
      font-size: 12px;
      font-weight: 900;
      color: #be123c;
      line-height: 1;
    }

    .produto-body {
      display: grid;
      grid-template-columns: 1fr 52mm;
      gap: 4mm;
      align-items: start;
    }

    .produto-body.no-preview { grid-template-columns: 1fr; }

    .label {
      font-size: 9px;
      font-weight: 900;
      color: #c7c7c7;
      text-transform: uppercase;
      letter-spacing: 0.35px;
      margin-bottom: 1mm;
    }

    .row {
      display: flex;
      gap: 6mm;
      flex-wrap: wrap;
      font-size: 11px;
      margin-bottom: 1.2mm;
    }

    .k { font-weight: 900; color: #111; }
    .v { color: #333; }

    .specs {
      margin-top: 2mm;
      padding-top: 2mm;
      border-top: 1px solid #eee;
    }

    .spec {
      font-size: 10px;
      padding: 1.2px 0;
      border-bottom: 1px solid #fafafa;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .obs {
      margin-top: 2mm;
      padding: 2mm 3mm;
      background: #fffbeb;
      border-left: 3px solid #f59e0b;
      font-size: 10px;
    }

    .preview {
      min-width: 0;
    }

    .frame {
      width: 100%;
      height: 54mm;
      border: 1px solid #f0f0f0;
      background: #fcfcfc;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .frame img {
      max-width: 95%;
      max-height: 50mm;
      object-fit: contain;
    }

    .legend {
      font-size: 9px;
      color: #999;
      margin-top: 2mm;
      font-style: italic;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .footer {
      padding-top: 2mm;
      border-top: 1px solid #111;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      align-items: center;
      font-size: 10px;
    }

    .footer .col { min-width: 0; }
    .footer .center { text-align: center; }
    .footer .right { text-align: right; }

    .muted {
      font-size: 8px;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      font-weight: 900;
    }

    [data-show-if=""],
    [data-show-if="false"],
    [data-show-if="null"],
    [data-show-if="undefined"] {
      display: none !important;
    }
  </style>
</head>

<body>
{{#each items}}
  <section class="item">
    <header class="topbar">
      <div class="left">
        <span data-show-if="{{data_envio}}">Envio: <b class="mono">{{data_envio}}</b></span>

        {{#if prioridade}}
          {{#if (eq prioridade 'ALTA')}}
            <span class="badge badge-high">Prioridade: ALTA</span>
          {{else}}
            <span class="badge badge-normal">Prioridade: {{prioridade}}</span>
          {{/if}}
        {{/if}}
      </div>

      <div class="right" data-show-if="{{forma_envio}}">
        Transporte: <b>{{forma_envio}}</b>
      </div>
    </header>

    <div class="ident">
      <div class="orderid">#{{numero}}</div>

      <div class="client">
        <div class="name" data-show-if="{{cliente}}">{{cliente}}</div>
        <div class="contact" data-show-if="{{telefone_cliente}}{{cidade_estado}}">
          {{telefone_cliente}}{{#if cidade_estado}}{{#if telefone_cliente}} • {{/if}}{{cidade_estado}}{{/if}}
        </div>
      </div>
    </div>

    <div class="products">
      {{#each produtos}}
        <div class="produto">
          <div class="produto-header">
            <div class="produto-title" data-show-if="{{descricao}}">{{descricao}}</div>
            <div class="produto-meta">
              <span class="chip" data-show-if="{{tipo_producao}}">{{tipo_producao}}</span>
              <span class="qtd" data-show-if="{{quantity}}">Qtd: {{quantity}}</span>
            </div>
          </div>

          <div class="produto-body {{#unless imagem}}no-preview{{/unless}}">
            <div class="text">
              <div class="row" data-show-if="{{dimensoes}}">
                <div><span class="k">Dimensoes:</span> <span class="v">{{dimensoes}}</span></div>
              </div>

              <div class="row" data-show-if="{{material}}">
                <div><span class="k">Material:</span> <span class="v">{{material}}</span></div>
              </div>

              <div class="row" data-show-if="{{emenda_label}}">
                <div><span class="k">Emenda:</span> <span class="v">{{emenda_label}}{{#if emenda_qtd}} ({{emenda_qtd}}){{/if}}</span></div>
              </div>

              <div class="specs">
                {{#if (eq tipo_producao 'painel')}}
                  <div class="spec" data-show-if="{{acabamentos_painel}}">Acabamento: <b>{{acabamentos_painel}}</b></div>
                  <div class="spec" data-show-if="{{overloque}}{{elastico}}">Costura: {{overloque}} / Elastico: {{elastico}}</div>
                  <div class="spec" data-show-if="{{ilhos_resumo}}{{cordinha_resumo}}">Extras: {{ilhos_resumo}} | {{cordinha_resumo}}</div>
                  <div class="spec" data-show-if="{{quantidade_paineis}}">Qtd. Paineis: {{quantidade_paineis}}</div>
                {{/if}}

                {{#if (eq tipo_producao 'totem')}}
                  <div class="spec" data-show-if="{{acabamento_totem_resumo}}">Acabamento: <b>{{acabamento_totem_resumo}}</b></div>
                  <div class="spec" data-show-if="{{acabamento_totem_outro}}">Obs.: {{acabamento_totem_outro}}</div>
                  <div class="spec" data-show-if="{{quantidade_totem}}">Qtd: {{quantidade_totem}}</div>
                {{/if}}

                {{#if (eq tipo_producao 'lona')}}
                  <div class="spec" data-show-if="{{acabamento_lona}}">Acabamento: <b>{{acabamento_lona}}</b></div>
                  <div class="spec" data-show-if="{{quantidade_ilhos}}">Ilhos: {{quantidade_ilhos}} ({{espaco_ilhos}})</div>
                  <div class="spec" data-show-if="{{quantidade_cordinha}}">Cordinha: {{quantidade_cordinha}} ({{espaco_cordinha}})</div>
                {{/if}}

                {{#if (eq tipo_producao 'adesivo')}}
                  <div class="spec" data-show-if="{{tipo_adesivo}}">Tipo: <b>{{tipo_adesivo}}</b></div>
                  <div class="spec" data-show-if="{{quantidade_adesivo}}">Qtd: {{quantidade_adesivo}}</div>
                {{/if}}
              </div>

              {{#if observacao_item}}
                <div class="obs">
                  <b style="font-size:8px; text-transform:uppercase;">Nota de producao</b><br/>
                  {{observacao_item}}
                </div>
              {{/if}}
            </div>

            {{#if imagem}}
              <aside class="preview">
                <div class="label">Visualizacao</div>
                <div class="frame">
                  <img
                    src="{{imagem}}"
                    alt="Previa"
                    onerror="this.remove();"
                  />
                </div>

                {{#if legenda_imagem}}
                  <div class="legend">{{legenda_imagem}}</div>
                {{/if}}
              </aside>
            {{/if}}
          </div>
        </div>
      {{/each}}
    </div>

    {{#if observacao}}
      <div class="obs">
        <b style="font-size:8px; text-transform:uppercase;">Observacao do pedido</b><br/>
        {{observacao}}
      </div>
    {{else}}
      {{#if observacao_pedido}}
        <div class="obs">
          <b style="font-size:8px; text-transform:uppercase;">Observacao do pedido</b><br/>
          {{observacao_pedido}}
        </div>
      {{/if}}
    {{/if}}

    <footer class="footer">
      <div class="col" data-show-if="{{designer}}">
        <div class="label" style="margin:0">Designer</div>
        <div style="font-weight:900">{{designer}}</div>
      </div>

      <div class="col center" data-show-if="{{vendedor}}">
        <div class="label" style="margin:0">Vendedor</div>
        <div style="font-weight:900">{{vendedor}}</div>
      </div>

      <div class="col right">
        <div class="muted">Controle de producao</div>
        <div class="muted" data-show-if="{{rip}}">RIP: {{rip}} • {{data_rip}}</div>
      </div>
    </footer>
  </section>
{{/each}}
</body>
</html>
